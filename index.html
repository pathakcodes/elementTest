<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTE Test Page - All Cases</title>
    
    <!-- CKEditor 4 -->
    <script src="https://cdn.ckeditor.com/4.22.1/full/ckeditor.js"></script>
    
    <!-- TinyMCE (self-hosted via jsDelivr) -->
    <script src="https://cdn.jsdelivr.net/npm/tinymce@6/tinymce.min.js"></script>
    
    <!-- Jodit -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jodit/3.24.5/jodit.min.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jodit/3.24.5/jodit.min.js"></script>
    
    <!-- Quill -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    
    <!-- Froala -->
    <link href="https://cdn.jsdelivr.net/npm/froala-editor@latest/css/froala_editor.pkgd.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/froala-editor@latest/js/froala_editor.pkgd.min.js"></script>
    
    <!-- CKEditor 5 -->
    <script src="https://cdn.ckeditor.com/ckeditor5/40.2.0/classic/ckeditor.js"></script>
    
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .selector-container {
            background: white;
            padding: 25px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .selector-container label {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-right: 15px;
        }
        
        #case-selector {
            padding: 12px 20px;
            font-size: 16px;
            border: 2px solid #3498db;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            min-width: 350px;
        }
        
        .test-case {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: none;
        }
        
        .test-case.active {
            display: block;
        }
        
        .test-case h2 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 20px;
            padding: 15px;
            background: #ecf0f1;
            border-left: 4px solid #3498db;
        }
        
        .test-case h2 .context-label {
            display: inline-block;
            padding: 6px 12px;
            margin-left: 12px;
            font-size: 14px;
            border-radius: 4px;
            background: #3498db;
            color: white;
            font-weight: normal;
        }
        
        .test-case h2 .context-label.shadow {
            background: #9b59b6;
        }
        
        .test-case h2 .context-label.iframe {
            background: #e74c3c;
        }
        
        .editor-container {
            min-height: 300px;
        }
        
        .editor {
            min-height: 300px;
            background: white;
        }
        
        textarea.editor {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
        }
        
        .shadow-host {
            border: 2px solid #9b59b6;
            padding: 20px;
            border-radius: 4px;
            background: #fff;
        }
        
        iframe {
            width: 100%;
            height: 400px;
            border: 2px solid #e74c3c;
            border-radius: 4px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <h1>üß™ RTE Test Page - All Cases</h1>
    
    <div class="selector-container">
        <label for="case-selector">Select Test Case:</label>
        <select id="case-selector">
            <option value="">-- Select RTE and Context --</option>
            <optgroup label="CKEditor 5">
                <option value="ckeditor5-direct">CKEditor 5 - Direct on Page</option>
                <option value="ckeditor5-shadow">CKEditor 5 - Shadow DOM</option>
                <option value="ckeditor5-iframe">CKEditor 5 - iFrame</option>
            </optgroup>
            <optgroup label="CKEditor 4">
                <option value="ckeditor4-direct">CKEditor 4 - Direct on Page</option>
                <option value="ckeditor4-shadow">CKEditor 4 - Shadow DOM</option>
                <option value="ckeditor4-iframe">CKEditor 4 - iFrame</option>
            </optgroup>
            <optgroup label="TinyMCE">
                <option value="tinymce-direct">TinyMCE - Direct on Page</option>
                <option value="tinymce-shadow">TinyMCE - Shadow DOM</option>
                <option value="tinymce-iframe">TinyMCE - iFrame</option>
            </optgroup>
            <optgroup label="Jodit">
                <option value="jodit-direct">Jodit - Direct on Page</option>
                <option value="jodit-shadow">Jodit - Shadow DOM</option>
                <option value="jodit-iframe">Jodit - iFrame</option>
            </optgroup>
            <optgroup label="Quill">
                <option value="quill-direct">Quill - Direct on Page</option>
                <option value="quill-shadow">Quill - Shadow DOM</option>
                <option value="quill-iframe">Quill - iFrame</option>
            </optgroup>
            <optgroup label="Froala">
                <option value="froala-direct">Froala - Direct on Page</option>
                <option value="froala-shadow">Froala - Shadow DOM</option>
                <option value="froala-iframe">Froala - iFrame</option>
            </optgroup>
            <optgroup label="Slate">
                <option value="slate-direct">Slate - Direct on Page</option>
                <option value="slate-shadow">Slate - Shadow DOM</option>
                <option value="slate-iframe">Slate - iFrame</option>
            </optgroup>
        </select>
    </div>
    
    <div id="test-container">
        <div class="loading">Please select a test case from the dropdown above</div>
    </div>
    
    <script>
        let currentEditor = null;
        
        // Cleanup function
        function cleanup() {
            // Remove TinyMCE instances
            if (window.tinymce) {
                tinymce.remove();
            }
            
            // Remove CKEditor 4 instances
            if (window.CKEDITOR) {
                for (let instance in CKEDITOR.instances) {
                    CKEDITOR.instances[instance].destroy(true);
                }
            }
            
            // Clear container
            document.getElementById('test-container').innerHTML = '<div class="loading">Loading...</div>';
            currentEditor = null;
        }
        
        // Helper to get iframe HTML
        function getIframeHTML(editorType, content) {
            const configs = {
                ckeditor5: {
                    libs: '<script src="https://cdn.ckeditor.com/ckeditor5/40.2.0/classic/ckeditor.js"><\/script>',
                    html: '<div id="editor" class="editor"></div>',
                    init: `ClassicEditor.create(document.querySelector('#editor'), {
                        toolbar: ['heading', '|', 'bold', 'italic', 'link', '|', 'bulletedList', 'numberedList', '|', 'blockQuote', '|', 'undo', 'redo']
                    }).then(e => e.setData('<p>${content}</p>')).catch(err => console.error(err));`
                },
                ckeditor4: {
                    libs: '<script src="https://cdn.ckeditor.com/4.22.1/full/ckeditor.js"><\/script>',
                    html: `<textarea id="editor" name="editor" class="editor">${content}</textarea>`,
                    init: `setTimeout(() => { 
                        if (CKEDITOR.instances['editor']) {
                            CKEDITOR.instances['editor'].destroy(true);
                        }
                        CKEDITOR.replace('editor', { 
                            height: 300,
                            toolbar: [
                                { name: 'basicstyles', items: [ 'Bold', 'Italic', 'Underline', 'Strike' ] },
                                { name: 'paragraph', items: [ 'NumberedList', 'BulletedList' ] },
                                { name: 'links', items: [ 'Link', 'Unlink' ] },
                                { name: 'styles', items: [ 'Format', 'Font', 'FontSize' ] },
                                { name: 'colors', items: [ 'TextColor', 'BGColor' ] }
                            ]
                        }); 
                    }, 300);`
                },
                tinymce: {
                    libs: '<script src="https://cdn.jsdelivr.net/npm/tinymce@6/tinymce.min.js"><\/script>',
                    html: `<textarea id="editor" class="editor">${content}</textarea>`,
                    init: `tinymce.init({ 
                        selector: '#editor', 
                        height: 350, 
                        menubar: false,
                        promotion: false,
                        branding: false,
                        plugins: 'lists link table code',
                        toolbar: 'undo redo | formatselect | bold italic underline strikethrough | forecolor backcolor | alignleft aligncenter alignright | bullist numlist | link table | code'
                    });`
                },
                jodit: {
                    libs: '<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jodit/3.24.5/jodit.min.css"/><script src="https://cdnjs.cloudflare.com/ajax/libs/jodit/3.24.5/jodit.min.js"><\/script>',
                    html: `<textarea id="editor" class="editor">${content}</textarea>`,
                    init: `Jodit.make('#editor', { height: 350 });`
                },
                quill: {
                    libs: '<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet"><script src="https://cdn.quilljs.com/1.3.6/quill.js"><\/script>',
                    html: '<div id="editor" class="editor"></div>',
                    init: `const q = new Quill('#editor', { theme: 'snow' }); q.setContents([{ insert: '${content}\\n' }]);`
                },
                froala: {
                    libs: '<link href="https://cdn.jsdelivr.net/npm/froala-editor@latest/css/froala_editor.pkgd.min.css" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/froala-editor@latest/js/froala_editor.pkgd.min.js"><\/script>',
                    html: `<textarea id="editor" class="editor">${content}</textarea>`,
                    init: `new FroalaEditor('#editor', { height: 350 });`
                },
                slate: {
                    libs: '',
                    html: `<div id="editor" class="editor" contenteditable="true" style="padding: 15px; border: 1px solid #ddd; min-height: 350px;">${content}</div>`,
                    init: ''
                }
            };
            
            const cfg = configs[editorType];
            return `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    ${cfg.libs}
    <style>
        body { font-family: Arial, sans-serif; padding: 15px; margin: 0; background: #f9f9f9; }
        .editor { min-height: 350px; background: white; }
        textarea.editor { width: 100%; padding: 10px; border: 1px solid #ddd; }
    </style>
</head>
<body>
    ${cfg.html}
    <script>
        window.addEventListener('load', () => { ${cfg.init} });
    <\/script>
</body>
</html>`;
        }
        
        // Create shadow DOM editor
        function createShadowEditor(hostId, editorType, content) {
            const host = document.getElementById(hostId);
            const shadowRoot = host.attachShadow({ mode: 'open' });
            
            const style = document.createElement('style');
            style.textContent = `
                .editor { min-height: 300px; background: white; }
                textarea.editor { width: 100%; padding: 10px; border: 1px solid #ddd; }
                .ck.ck-editor { width: 100%; }
                .ck-editor__editable { min-height: 300px; }
            `;
            shadowRoot.appendChild(style);
            
            // Add CSS links for editors that need them
            const cssMap = {
                jodit: 'https://cdnjs.cloudflare.com/ajax/libs/jodit/3.24.5/jodit.min.css',
                quill: 'https://cdn.quilljs.com/1.3.6/quill.snow.css',
                froala: 'https://cdn.jsdelivr.net/npm/froala-editor@latest/css/froala_editor.pkgd.min.css',
                ckeditor5: 'https://cdn.ckeditor.com/ckeditor5/40.2.0/classic/ckeditor.css'
            };
            
            if (cssMap[editorType]) {
                const link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = cssMap[editorType];
                shadowRoot.appendChild(link);
            }
            
            const container = document.createElement('div');
            const editorId = hostId + '-editor';
            
            setTimeout(() => {
                const editors = {
                    ckeditor5: () => {
                        // CKEditor 5 doesn't work well in Shadow DOM due to style encapsulation
                        // We'll render it in light DOM but inside the shadow host container
                        const wrapper = document.createElement('div');
                        wrapper.style.cssText = 'padding: 15px; background: #fffbea; border: 2px dashed #9b59b6; border-radius: 4px; margin-bottom: 10px;';
                        wrapper.innerHTML = '<strong>‚ö†Ô∏è Note:</strong> CKEditor 5 initialized within Shadow DOM context (rendered in light DOM due to CKEditor limitations)';
                        shadowRoot.appendChild(wrapper);
                        
                        const div = document.createElement('div');
                        div.id = editorId;
                        div.className = 'editor';
                        container.appendChild(div);
                        shadowRoot.appendChild(container);
                        
                        ClassicEditor.create(div, {
                            toolbar: ['heading', '|', 'bold', 'italic', 'link', '|', 'bulletedList', 'numberedList', '|', 'blockQuote', '|', 'undo', 'redo']
                        }).then(e => {
                            e.setData(`<p>${content}</p>`);
                        }).catch(err => {
                            console.error('CKEditor 5 Shadow DOM error:', err);
                        });
                    },
                    ckeditor4: () => {
                        // CKEditor 4 doesn't support Shadow DOM due to legacy architecture
                        const wrapper = document.createElement('div');
                        wrapper.style.cssText = 'padding: 15px; background: #fff3cd; border: 2px solid #ffc107; border-radius: 4px; margin-bottom: 15px;';
                        wrapper.innerHTML = '<strong>‚ö†Ô∏è Limitation:</strong> CKEditor 4 does not support Shadow DOM due to its legacy architecture. Showing basic editable area instead.';
                        shadowRoot.appendChild(wrapper);
                        
                        const editableDiv = document.createElement('div');
                        editableDiv.contentEditable = 'true';
                        editableDiv.style.cssText = 'min-height: 300px; padding: 15px; border: 1px solid #ddd; background: white; font-family: Arial, sans-serif;';
                        editableDiv.innerHTML = content;
                        shadowRoot.appendChild(editableDiv);
                    },
                    tinymce: () => {
                        const textarea = document.createElement('textarea');
                        textarea.id = editorId;
                        textarea.className = 'editor';
                        textarea.value = content;
                        container.appendChild(textarea);
                        shadowRoot.appendChild(container);
                        tinymce.init({ 
                            target: textarea, 
                            height: 300, 
                            menubar: false,
                            promotion: false,
                            branding: false,
                            plugins: 'lists link table code',
                            toolbar: 'undo redo | formatselect | bold italic underline strikethrough | forecolor backcolor | alignleft aligncenter alignright | bullist numlist | link table | code'
                        });
                    },
                    jodit: () => {
                        const textarea = document.createElement('textarea');
                        textarea.id = editorId;
                        textarea.className = 'editor';
                        textarea.value = content;
                        container.appendChild(textarea);
                        shadowRoot.appendChild(container);
                        Jodit.make(textarea, { height: 300 });
                    },
                    quill: () => {
                        const div = document.createElement('div');
                        div.id = editorId;
                        div.className = 'editor';
                        container.appendChild(div);
                        shadowRoot.appendChild(container);
                        const q = new Quill(div, { theme: 'snow' });
                        q.setContents([{ insert: content + '\n' }]);
                    },
                    froala: () => {
                        const textarea = document.createElement('textarea');
                        textarea.id = editorId;
                        textarea.className = 'editor';
                        textarea.value = content;
                        container.appendChild(textarea);
                        shadowRoot.appendChild(container);
                        new FroalaEditor(textarea, { height: 300 });
                    },
                    slate: () => {
                        const div = document.createElement('div');
                        div.id = editorId;
                        div.className = 'editor';
                        div.contentEditable = 'true';
                        div.style.cssText = 'padding: 15px; border: 1px solid #ddd; min-height: 300px;';
                        div.textContent = content;
                        container.appendChild(div);
                        shadowRoot.appendChild(container);
                    }
                };
                
                if (editors[editorType]) {
                    editors[editorType]();
                }
            }, 100);
        }
        
        // Render test case
        function renderTestCase(caseId) {
            if (!caseId) {
                document.getElementById('test-container').innerHTML = '<div class="loading">Please select a test case from the dropdown above</div>';
                return;
            }
            
            cleanup();
            
            const [editor, context] = caseId.split('-');
            const editorNames = {
                ckeditor5: 'CKEditor 5',
                ckeditor4: 'CKEditor 4',
                tinymce: 'TinyMCE',
                jodit: 'Jodit',
                quill: 'Quill',
                froala: 'Froala',
                slate: 'Slate'
            };
            
            const contextNames = {
                direct: 'Direct on Page',
                shadow: 'Shadow DOM',
                iframe: 'iFrame'
            };
            
            const contextClass = context === 'direct' ? '' : context;
            const content = `Hello from ${editorNames[editor]} (${contextNames[context]})`;
            
            let html = `<div class="test-case active">
                <h2>${editorNames[editor]} <span class="context-label ${contextClass}">${contextNames[context]}</span></h2>`;
            
            if (context === 'direct') {
                html += `<div class="editor-container" id="editor-direct-container"></div>`;
            } else if (context === 'shadow') {
                html += `<div class="shadow-host" id="shadow-host"></div>`;
            } else if (context === 'iframe') {
                html += `<iframe id="editor-iframe"></iframe>`;
            }
            
            html += `</div>`;
            
            document.getElementById('test-container').innerHTML = html;
            
            setTimeout(() => {
                if (context === 'direct') {
                    const container = document.getElementById('editor-direct-container');
                    
                    if (editor === 'ckeditor5') {
                        const div = document.createElement('div');
                        div.id = 'editor-direct';
                        div.className = 'editor';
                        container.appendChild(div);
                        
                        ClassicEditor.create(div, {
                            toolbar: ['heading', '|', 'bold', 'italic', 'link', '|', 'bulletedList', 'numberedList', '|', 'blockQuote', '|', 'undo', 'redo']
                        }).then(e => e.setData(`<p>${content}</p>`)).catch(err => console.error(err));
                    } else if (editor === 'ckeditor4') {
                        const textarea = document.createElement('textarea');
                        textarea.id = 'editor-direct';
                        textarea.name = 'editor-direct';
                        textarea.className = 'editor';
                        textarea.value = content;
                        container.appendChild(textarea);
                        setTimeout(() => {
                            if (CKEDITOR.instances['editor-direct']) {
                                CKEDITOR.instances['editor-direct'].destroy(true);
                            }
                            CKEDITOR.replace('editor-direct', {
                                height: 300,
                                toolbar: [
                                    { name: 'document', items: [ 'Source', '-', 'NewPage', 'Preview', 'Print' ] },
                                    { name: 'clipboard', items: [ 'Cut', 'Copy', 'Paste', 'PasteText', 'PasteFromWord', '-', 'Undo', 'Redo' ] },
                                    { name: 'editing', items: [ 'Find', 'Replace', '-', 'SelectAll' ] },
                                    '/',
                                    { name: 'basicstyles', items: [ 'Bold', 'Italic', 'Underline', 'Strike', 'Subscript', 'Superscript', '-', 'RemoveFormat' ] },
                                    { name: 'paragraph', items: [ 'NumberedList', 'BulletedList', '-', 'Outdent', 'Indent', '-', 'Blockquote' ] },
                                    { name: 'links', items: [ 'Link', 'Unlink' ] },
                                    { name: 'insert', items: [ 'Image', 'Table', 'HorizontalRule', 'SpecialChar' ] },
                                    '/',
                                    { name: 'styles', items: [ 'Styles', 'Format', 'Font', 'FontSize' ] },
                                    { name: 'colors', items: [ 'TextColor', 'BGColor' ] },
                                    { name: 'tools', items: [ 'Maximize' ] }
                                ]
                            });
                        }, 200);
                    } else if (editor === 'tinymce') {
                        const textarea = document.createElement('textarea');
                        textarea.id = 'editor-direct';
                        textarea.className = 'editor';
                        textarea.value = content;
                        container.appendChild(textarea);
                        tinymce.init({ 
                            selector: '#editor-direct', 
                            height: 300, 
                            menubar: false,
                            promotion: false,
                            branding: false,
                            plugins: 'lists link table code',
                            toolbar: 'undo redo | formatselect | bold italic underline strikethrough | forecolor backcolor | alignleft aligncenter alignright | bullist numlist | link table | code'
                        });
                    } else if (editor === 'jodit') {
                        const textarea = document.createElement('textarea');
                        textarea.id = 'editor-direct';
                        textarea.className = 'editor';
                        textarea.value = content;
                        container.appendChild(textarea);
                        Jodit.make('#editor-direct', { height: 300 });
                    } else if (editor === 'quill') {
                        const div = document.createElement('div');
                        div.id = 'editor-direct';
                        div.className = 'editor';
                        container.appendChild(div);
                        const q = new Quill('#editor-direct', { theme: 'snow' });
                        q.setContents([{ insert: content + '\n' }]);
                    } else if (editor === 'froala') {
                        const textarea = document.createElement('textarea');
                        textarea.id = 'editor-direct';
                        textarea.className = 'editor';
                        textarea.value = content;
                        container.appendChild(textarea);
                        new FroalaEditor('#editor-direct', { height: 300 });
                    } else if (editor === 'slate') {
                        const div = document.createElement('div');
                        div.id = 'editor-direct';
                        div.className = 'editor';
                        div.contentEditable = 'true';
                        div.style.cssText = 'padding: 15px; border: 1px solid #ddd; min-height: 300px;';
                        div.textContent = content;
                        container.appendChild(div);
                    }
                } else if (context === 'shadow') {
                    createShadowEditor('shadow-host', editor, content);
                } else if (context === 'iframe') {
                    document.getElementById('editor-iframe').srcdoc = getIframeHTML(editor, content);
                }
            }, 100);
        }
        
        // Event listener
        document.getElementById('case-selector').addEventListener('change', (e) => {
            renderTestCase(e.target.value);
        });
    </script>
</body>
</html>
